    @model SimpleCMSWeb.Models.ModelView.RegistrationFormVM

    @{
        ViewData["Title"] = "Patient Registration";
        Layout = "_AuthLayout";
    }

    <!-- Styling omitted for brevity, keep your current CSS here -->

    <div class="min-vh-100 d-flex align-items-center" style="background: linear-gradient(90deg, #0052cc 0%, #1a75ff 100%);">
        <div class="container py-3 py-md-5">
            <div class="row justify-content-center">
                <div class="col-12 col-xl-10">
                    <div class="card border-0 shadow-lg">
                        <div class="card-body p-4">
                            <h2 class="mb-4 text-center" style="color: #1a75ff;">Patient Registration</h2>

                            <div class="step-progress">
                                <div class="step active" data-step="1">1</div>
                                <div class="step" data-step="2">2</div>
                                <div class="step" data-step="3">3</div>
                                @* <div class="step" data-step="4">4</div> *@
                            </div>

                            <form asp-action="Register" method="post" enctype="multipart/form-data" id="registrationForm">
                                <div class="form-section active" data-step="1">
                                    <h3 class="section-title">Personal Information</h3>
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <label asp-for="Lastname" class="form-label"></label>
                                            <input asp-for="Lastname" class="form-control" required />
                                            <span asp-validation-for="Lastname" class="text-danger"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <label asp-for="Firstname" class="form-label"></label>
                                            <input asp-for="Firstname" class="form-control" required />
                                            <span asp-validation-for="Firstname" class="text-danger"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <label asp-for="Middlename" class="form-label"></label>
                                            <input asp-for="Middlename" class="form-control" required />
                                            <span asp-validation-for="Middlename" class="text-danger"></span>
                                        </div>
                                        <div class="col-md-3">
                                            <label asp-for="Suffixname" class="form-label"></label>
                                            <input asp-for="Suffixname" class="form-control" />
                                            <span asp-validation-for="Suffixname" class="text-danger"></span>
                                        </div>
                                        <div class="col-md-4">
                                            <label asp-for="Birthdate" class="form-label"></label>
                                            <input asp-for="Birthdate" type="date" class="form-control" required />
                                            <span asp-validation-for="Birthdate" class="text-danger"></span>
                                        </div>
                                        <div class="col-md-4">
                                            <label asp-for="Gender" class="form-label"></label>
                                            <select asp-for="Gender" class="form-select" required>
                                                <option value="">Select Gender</option>
                                                <option>M</option>
                                                <option>F</option>
                                            </select>
                                            <span asp-validation-for="Gender" class="text-danger"></span>
                                        </div>
                                        <div class="col-md-4">
                                            <label asp-for="Civilstatus" class="form-label"></label>
                                            <select asp-for="Civilstatus" class="form-select" required>
                                                <option value="">Select Status</option>
                                                <option>Single</option>
                                                <option>Married</option>
                                                <option>Widowed</option>
                                                <option>Divorced</option>
                                            </select>
                                            <span asp-validation-for="Civilstatus" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Step 2: Contact Information -->
                                <div class="form-section" data-step="2">
                                    <h3 class="section-title">Contact Information</h3>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label asp-for="Mobileno" class="form-label"></label>
                                            <input asp-for="Mobileno" type="tel" class="form-control" pattern="\d{11}" maxlength="11" required />
                                            <span asp-validation-for="Mobileno" class="text-danger"></span>
                                        </div>
                                        <div class="col-12">
                                            <label asp-for="Homeaddress" class="form-label"></label>
                                            <input asp-for="Homeaddress" class="form-control" />
                                        </div>
                                        <div class="col-md-4">
                                            <label asp-for="Municipalityid" class="form-label">Municipality</label>
                                            <select asp-for="Municipalityid" class="form-select" required>
                                                <option value="">-- Select Municipality --</option>
                                                @foreach (var m in Model.Municipalities)
                                                {
                                                    <option value="@m.MunicipalityId">@m.MunicipalityName</option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                @* <!-- Step 3: Medical Information -->
                                <div class="form-section" data-step="3">
                                    <h3 class="section-title">Medical Information</h3>
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <label asp-for="Bloodtype" class="form-label"></label>
                                            <input asp-for="Bloodtype" class="form-control" />
                                        </div>
                                        <div class="col-md-9">
                                            <label asp-for="Allergies" class="form-label"></label>
                                            <input asp-for="Allergies" class="form-control" />
                                        </div>
                                        <div class="col-12">
                                            <label asp-for="Familymedicalhistory" class="form-label"></label>
                                            <textarea asp-for="Familymedicalhistory" class="form-control" rows="3"></textarea>
                                        </div>
                                        <div class="col-12">
                                            <label asp-for="Socialhistory" class="form-label"></label>
                                            <textarea asp-for="Socialhistory" class="form-control" rows="3"></textarea>
                                        </div>
                                    </div>
                                </div> *@

                                <!-- Step 4: Additional Information -->
                                <div class="form-section" data-step="3">
                                    <h3 class="section-title">Additional Information</h3>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label asp-for="Philhealthno" class="form-label"></label>
                                            <input asp-for="Philhealthno" class="form-control" id="PhilHealthNo" disabled />
                                            <span asp-validation-for="Philhealthno" class="text-danger"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <label asp-for="Isphilhealthmember" class="form-label"></label>
                                            <select asp-for="Isphilhealthmember" class="form-select" id="IsPhilHealthMember">
                                                <option value="">Select</option>
                                                <option value="true">Yes</option>
                                                <option value="false">No</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label asp-for="Occupation" class="form-label"></label>
                                            <input asp-for="Occupation" class="form-control" />
                                        </div>
                                        <div class="col-md-6">
                                            <label asp-for="Company" class="form-label"></label>
                                            <input asp-for="Company" class="form-control" />
                                        </div>
                                    <div class="col-md-6">
                                        <label asp-for="Username" class="form-label"></label>
                                        <input asp-for="Username" class="form-control" required />
                                        <span asp-validation-for="Username" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="Password" class="form-label"></label>
                                        <input asp-for="Password" class="form-control" type="password" />
                                        <span asp-validation-for="Password" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="ConfirmPassword" class="form-label"></label>
                                        <input asp-for="ConfirmPassword" class="form-control" type="password" />
                                        <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                                    </div>

                                    </div>
                                </div>

                            <div class="row mt-4">
                                <div class="col-6">
                                    <button type="button" id="prevBtn" class="btn btn-outline-primary w-100 d-none mb-2">
                                        <i class="fas fa-arrow-left me-2"></i>Previous
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button type="button" id="nextBtn" class="btn btn-primary w-100 mb-2">
                                        Next<i class="fas fa-arrow-right ms-2"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <button type="submit" id="submitBtn" class="btn btn-success w-100 d-none">
                                        Submit Registration
                                    </button>
                                </div>
                            </div>



                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let currentStep = 1;
            const totalSteps = 3;
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            const submitBtn = document.getElementById('submitBtn');

            const serverStep = parseInt('@(ViewData["Step"] ?? "0")');
            if (!isNaN(serverStep) && serverStep > 0) {
                currentStep = serverStep;
                showStep(currentStep);
            } else {
                showStep(1);
            }

            const birthdateInput = document.querySelector('input[name="Birthdate"]');
            if (birthdateInput) {
                const today = new Date();
                const maxDate = new Date(today.setFullYear(today.getFullYear() - 18)).toISOString().split('T')[0];
                birthdateInput.max = maxDate;
            }

            function showStep(step) {
                document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
                const currentSection = document.querySelector(`.form-section[data-step="${step}"]`);
                if (currentSection) currentSection.classList.add('active');

                document.querySelectorAll('.step').forEach(s => {
                    const stepNum = parseInt(s.dataset.step);
                    s.classList.remove('active', 'completed');
                    if (stepNum === step) s.classList.add('active');
                    else if (stepNum < step) s.classList.add('completed');
                });

                prevBtn.classList.toggle('d-none', step === 1);
                nextBtn.classList.toggle('d-none', step === totalSteps);
                submitBtn.classList.toggle('d-none', step !== totalSteps);
            }

            function validateStep(step) {
                if (step === 1) {
                    const lastname = document.querySelector('input[name="Lastname"]');
                    const firstname = document.querySelector('input[name="Firstname"]');
                    const middlename = document.querySelector('input[name="Middlename"]');
                    const birthdate = document.querySelector('input[name="Birthdate"]');
                    const gender = document.querySelector('select[name="Gender"]');
                    const civilstatus = document.querySelector('select[name="Civilstatus"]');
                    return lastname.value.trim() !== "" &&
                        firstname.value.trim() !== "" &&
                        middlename.value.trim() !== "" &&
                        birthdate.value.trim() !== "" &&
                        gender.value.trim() !== "" &&
                        civilstatus.value.trim() !== "";
                }
                if (step === 2) {
                    const mobileno = document.querySelector('input[name="Mobileno"]');
                    const municipality = document.querySelector('select[name="Municipalityid"]');
                    return mobileno.value.trim() !== "" &&
                        municipality.value.trim() !== "";
                }
                return true;
            }

            nextBtn.addEventListener('click', () => {
                if (validateStep(currentStep)) {
                    if (currentStep < totalSteps) {
                        currentStep++;
                        showStep(currentStep);
                    }
                } else {
                    alert('Please fill in all required fields before proceeding.');
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    showStep(currentStep);
                }
            });

            // PhilHealth logic
            const memberSelect = document.getElementById('IsPhilHealthMember');
            const philHealthInput = document.getElementById('PhilHealthNo');
            function togglePhilHealthInput() {
                if (memberSelect.value === "true") {
                    philHealthInput.disabled = false;
                } else {
                    philHealthInput.disabled = true;
                    philHealthInput.value = '';
                }
            }
            togglePhilHealthInput();
            memberSelect.addEventListener('change', togglePhilHealthInput);
        });
    </script>
}

@* @section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let currentStep = 1;
            const totalSteps = 3;
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            const submitBtn = document.getElementById('submitBtn');

            const serverStep = parseInt('@(ViewData["Step"] ?? "0")');
            if (!isNaN(serverStep) && serverStep > 0) {
                currentStep = serverStep;
                showStep(currentStep);
            } else {
                showStep(1);
            }

            const birthdateInput = document.querySelector('input[name="Birthdate"]');
            if (birthdateInput) {
                const today = new Date();
                const maxDate = new Date(today.setFullYear(today.getFullYear() - 18)).toISOString().split('T')[0];
                birthdateInput.max = maxDate;
            }

            function showStep(step) {
                document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
                const currentSection = document.querySelector(`.form-section[data-step="${step}"]`);
                if (currentSection) currentSection.classList.add('active');

                document.querySelectorAll('.step').forEach(s => {
                    const stepNum = parseInt(s.dataset.step);
                    s.classList.remove('active', 'completed');
                    if (stepNum === step) s.classList.add('active');
                    else if (stepNum < step) s.classList.add('completed');
                });

                prevBtn.classList.toggle('d-none', step === 1);
                nextBtn.classList.toggle('d-none', step === totalSteps);
                submitBtn.classList.toggle('d-none', step !== totalSteps);
            }

            function validateStep(step) {
                if (step === 1) {
                    const lastname = document.querySelector('input[name="Lastname"]');
                    const firstname = document.querySelector('input[name="Firstname"]');
                    const middlename = document.querySelector('input[name="Middlename"]');
                    const birthdate = document.querySelector('input[name="Birthdate"]');
                    const gender = document.querySelector('select[name="Gender"]');
                    const civilstatus = document.querySelector('select[name="Civilstatus"]');
                    return lastname.value.trim() !== "" &&
                        firstname.value.trim() !== "" &&
                        middlename.value.trim() !== "" &&
                        birthdate.value.trim() !== "" &&
                        gender.value.trim() !== "" &&
                        civilstatus.value.trim() !== "";
                }
                if (step === 2) {
                    const mobileno = document.querySelector('input[name="Mobileno"]');
                    const municipality = document.querySelector('select[name="Municipalityid"]');
                    return mobileno.value.trim() !== "" &&
                        municipality.value.trim() !== "";
                }
                return true;
            }

            nextBtn.addEventListener('click', () => {
                if (validateStep(currentStep)) {
                    if (currentStep < totalSteps) {
                        currentStep++;
                        showStep(currentStep);
                    }
                } else {
                    alert('Please fill in all required fields before proceeding.');
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    showStep(currentStep);
                }
            });

            // PhilHealth logic
            const memberSelect = document.getElementById('IsPhilHealthMember');
            const philHealthInput = document.getElementById('PhilHealthNo');
            function togglePhilHealthInput() {
                if (memberSelect.value === "true") {
                    philHealthInput.disabled = false;
                } else {
                    philHealthInput.disabled = true;
                    philHealthInput.value = '';
                }
            }
            togglePhilHealthInput();
            memberSelect.addEventListener('change', togglePhilHealthInput);

            // ✅ Delay form submission by 5 seconds
            const form = document.getElementById("registrationForm");
            form.addEventListener("submit", function (e) {
                e.preventDefault(); // Stop immediate submission

                // Capture form values
                const formData = {
                    Lastname: form.querySelector("[name='Lastname']")?.value,
                    Firstname: form.querySelector("[name='Firstname']")?.value,
                    Middlename: form.querySelector("[name='Middlename']")?.value,
                    Suffixname: form.querySelector("[name='Suffixname']")?.value,
                    Birthdate: form.querySelector("[name='Birthdate']")?.value,
                    Gender: form.querySelector("[name='Gender']")?.value,
                    Civilstatus: form.querySelector("[name='Civilstatus']")?.value,
                    Mobileno: form.querySelector("[name='Mobileno']")?.value,
                    Homeaddress: form.querySelector("[name='Homeaddress']")?.value,
                    Municipalityid: form.querySelector("[name='Municipalityid']")?.value,
                    Philhealthno: form.querySelector("[name='Philhealthno']")?.value,
                    Isphilhealthmember: form.querySelector("[name='Isphilhealthmember']")?.value,
                    Occupation: form.querySelector("[name='Occupation']")?.value,
                    Company: form.querySelector("[name='Company']")?.value,
                    Username: form.querySelector("[name='Username']")?.value,
                    Password: form.querySelector("[name='Password']")?.value,
                    ConfirmPassword: form.querySelector("[name='ConfirmPassword']")?.value
                };

                console.log("⏳ Submitting form in 5 seconds...");
                console.log("🚀 Form Data Preview:", formData);

                setTimeout(() => {
                    console.log("✅ Submitting now...");
                    form.submit(); // Now submit the form after delay
                }, 5000);
            });
        });
    </script>
} *@

